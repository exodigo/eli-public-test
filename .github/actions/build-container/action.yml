name: 'build-container'
description: 'Build a container'

inputs:
  container_file:
    description: Name of the file to use for build
    default: "Containerfile"
  working_directory:
    description: Working directory during build
    default: "."
  container_tag:
    description: The tag to give the container
    required: true
  container_input:
    description: Input for Containerfile
    default: ""
outputs:
  container:
    description: A temporary tag of the built container
    value: ${{ steps.build.outputs.container }}

runs:
  using: "composite"
  steps:
    - name: container.build
      id: build
      shell: sh
      working-directory: ${{ inputs.working_directory }}
      env:

        OCI_CONTAINER_FILE: ${{ inputs.container_file }}
      run: |
        container="${AWS_ECR_NAME}/${AWS_ECR_CI_REPOSITORY_NAME}/${AWS_ECR_CI_TEMPORARY_REPOSITORY}:temp-${GITHUB_RUN_ID}-${GITHUB_RUN_NUMBER}-$(date -u +%s)"
        OCI_ARG_LOCAL_TAG="--tag=${container}"
        eval "${{ inputs.container_input }}"
        cat >> "${GITHUB_OUTPUT}" << __EOF__
        container=${container}
        __EOF__
        . "${{ github.action_path }}/build-container.sh"
